<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Everything delivered in 10 minutes | blinkit</title>
    <link rel="stylesheet" href="./styles/addCategory.css" />
    <link rel="stylesheet" href="./styles/footer.css" />
    <link rel="stylesheet" href="./styles/index.css" />
    <link
      rel="icon"
      type="image/x-icon"
      href="https://images.moneycontrol.com/static-mcnews/2022/01/pjimage-29-770x433.jpg?impolicy=website&width=770&height=431"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script src="./scripts/index.js" type="module"></script>
    <style>
      .magic-glow {
        box-shadow: 0 0 30px rgba(255, 255, 0, 0.6);
        border-radius: 12px;
        transform: scale(1.05);
      }

      #magic-key {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: gold;
        color: black;
        font-size: 24px;
        padding: 12px 16px;
        border-radius: 50%;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        z-index: 9999;
      }
    </style>
  </head>

  <body>
    <!-- navbar div -->
    <div id="NAVBAR"></div>

    <div id="prod_left_right">
      <div id="left_prod">
        <img src="" alt="" id="prod_img" />
        <div id="product">Product Details</div>
        <div id="prod_details">
          <!-- details like shelf life, manufacturer, etc. -->
          <!-- ... (unchanged content) ... -->
        </div>
      </div>
      <div id="right_prod">
        <div id="top">
          <div id="right_prod_info">
            <span id="right_name"></span>
            <button>add to cart</button>
            <div id="right_weight"></div>
            <div id="right_price"></div>
            <div id="hr"></div>
          </div>
          <div id="right_prod_unit">
            <div id="unit_title">unit</div>
            <div id="right_unit"></div>
          </div>
        </div>
        <div id="bottom">
          <div id="why_shop">Why shop from blinkit (formerly grofers)?</div>
          <div id="shopping_details">
            <!-- promo info -->
            <!-- ... (unchanged content) ... -->
          </div>
        </div>
      </div>
    </div>

    <!-- footer -->
    <div id="footer_display"></div>

    <!-- magic mode toggle button -->
    <div id="magic-key" onclick="toggleMagicMode()">ðŸª„</div>

    <!-- MAGIC SCRIPT -->
    <script>
      let magicMode = false;
      let floatingClone = null;
      let offsetX = 0;
      let offsetY = 0;
      let delayTimer = null;

      function toggleMagicMode() {
        magicMode = !magicMode;
        document.body.style.cursor = magicMode ? "grab" : "default";
        if (!magicMode && floatingClone) {
          floatingClone.remove();
          floatingClone = null;
          clearTimeout(delayTimer);
        }
      }

      function initiateMagicClone(originalEl, clientX, clientY) {
        const rect = originalEl.getBoundingClientRect();
        const aspectRatio = rect.width / rect.height;
        const newHeight = window.innerHeight * 0.8;
        const newWidth = newHeight * aspectRatio;

        const clone = originalEl.cloneNode(true);
        clone.style.position = "fixed";
        clone.style.top = `${clientY - newHeight / 2}px`;
        clone.style.left = `${clientX - newWidth / 2}px`;
        clone.style.width = `${newWidth}px`;
        clone.style.height = `${newHeight}px`;
        clone.style.zIndex = "1000";
        clone.style.pointerEvents = "none";
        clone.style.transition = "transform 0.3s ease";
        clone.classList.add("magic-glow");

        document.body.appendChild(clone);
        floatingClone = clone;

        offsetX = newWidth / 2;
        offsetY = newHeight / 2;
      }

      function startDrag(clientX, clientY) {
        if (!floatingClone) return;

        floatingClone.style.top = `${clientY - offsetY}px`;
        floatingClone.style.left = `${clientX - offsetX}px`;

        const moveHandler = (e) => {
          const x = e.touches ? e.touches[0].clientX : e.clientX;
          const y = e.touches ? e.touches[0].clientY : e.clientY;
          floatingClone.style.top = `${y - offsetY}px`;
          floatingClone.style.left = `${x - offsetX}px`;
        };

        const endHandler = () => {
          floatingClone.remove();
          floatingClone = null;
          document.removeEventListener("mousemove", moveHandler);
          document.removeEventListener("mouseup", endHandler);
          document.removeEventListener("touchmove", moveHandler);
          document.removeEventListener("touchend", endHandler);
        };

        document.addEventListener("mousemove", moveHandler);
        document.addEventListener("mouseup", endHandler);
        document.addEventListener("touchmove", moveHandler);
        document.addEventListener("touchend", endHandler);
      }

      function handleMagicTrigger(e, isTouch = false) {
        if (!magicMode || delayTimer) return;

        const target = e.target.closest("#prod_img");
        if (!target || target.dataset.used === "true") return;

        target.dataset.used = "true";
        const clientX = isTouch ? e.touches[0].clientX : e.clientX;
        const clientY = isTouch ? e.touches[0].clientY : e.clientY;

        const fullCard = document.querySelector("#prod_left_right");
        if (!fullCard) return;

        fullCard.style.transition = "opacity 0.3s ease";
        fullCard.style.opacity = "0";

        delayTimer = setTimeout(() => {
          delayTimer = null;
          setTimeout(() => {
            fullCard.remove();
          }, 300);
          initiateMagicClone(target, clientX, clientY);
        }, 3000);
      }

      document.addEventListener("mousedown", (e) => handleMagicTrigger(e, false));
      document.addEventListener("touchstart", (e) => handleMagicTrigger(e, true));

      document.addEventListener("mousedown", function (e) {
        if (!magicMode || !floatingClone) return;
        e.preventDefault();
        startDrag(e.clientX, e.clientY);
      });
      document.addEventListener("touchstart", function (e) {
        if (!magicMode || !floatingClone) return;
        e.preventDefault();
        startDrag(e.touches[0].clientX, e.touches[0].clientY);
      });
    </script>

    <script type="module">
      import navbar from "./components/navbar.js";
      document.getElementById("NAVBAR").innerHTML = navbar();

      // Product Display Logic
      let data = JSON.parse(localStorage.getItem("pData"));
      let display = (data) => {
        document.querySelector("#prod_img").src = data.image;
        document.querySelector("#right_name").textContent = data.name;
        document.querySelector("#right_weight").textContent = data.wt;
        document.querySelector("#right_price").textContent = "â‚¹" + data.price;
        document.querySelector("#right_unit").textContent = data.wt;
        let div = document.createElement("div");
        div.textContent = data.wt;
        div.setAttribute("class", "lh2 mg2 fs2 cl");
        document.querySelector("#unit").append(div);
      };
      display(data);
    </script>
  </body>
</html>
